{% extends 'base.html' %}

{% block content %}
<div class="vh-100 d-flex justify-content-center align-items-center" style="background: linear-gradient(45deg, rgba(25,135,84,1) 0%, rgba(255,250,250,1) 100%);">
    <div class="card p-5 rounded-4 shadow w-50">
        <div class="mb-2">
            <a type="button"
                class="btn btn-link link-secondary link-offset-2 link-offset-3-hover link-underline link-underline-opacity-0 link-underline-opacity-75-hover"
                href="{% url 'index' %}">
                <i class="fa-solid fa-backward-step"></i>
                <span class="fw-light">Regresar al inicio</span>
            </a>
        </div>
        <div class="text-center mb-3">
            <h2>Crear cuenta</h2>
            <h4 class="fw-light text-muted">Registro de alumnos</h4>
        </div>
        <form id="registration-form" method="post">
            {% csrf_token %}
            <div id="step-1" class="form-step">
                <div class="mb-3">
                    <h4 class="fw-light text-muted">Información personal</h4>
                </div>
                <div class="row g-3">
                    <div class="col-md-6">
                        <div class="mb-3">
                            <label for="{{ form.nombre.id_for_label }}" class="form-label">Nombre:</label>
                            {{ form.nombre }}
                        </div>
                    </div>
                    <div class="col-md-6">
                        <div class="mb-3">
                            <label for="{{ form.apellido_paterno.id_for_label }}" class="form-label">Apellido
                                Paterno:</label>
                            {{ form.apellido_paterno }}
                        </div>
                    </div>
                </div>
                <div class="row g-3">
                    <div class="col-md-6">
                        <div class="mb-3">
                            <label for="{{ form.apellido_materno.id_for_label }}" class="form-label">Apellido
                                Materno:</label>
                            {{ form.apellido_materno }}
                        </div>
                    </div>
                    <div class="col-md-6">
                        <div class="mb-3">
                            <label for="{{ form.sexo.id_for_label }}" class="form-label">Sexo:</label>
                            {{ form.sexo }}
                        </div>
                    </div>
                </div>
                <div class="row g-3">
                    <div class="col-md-6">
                        <div class="mb-3">
                            <label for="{{ form.correo_personal.id_for_label }}" class="form-label">Correo
                                Personal:</label>
                            {{ form.correo_personal }}
                            <div class="form-text">
                                Incluye un símbolo "@" en tu dirección de correo electrónico.
                            </div>
                        </div>
                    </div>
                    <div class="col-md-6">
                        <div class="mb-3">
                            <label for="{{ form.nombre.id_for_label }}" class="form-label">Teléfono:</label>
                            {{ form.telefono }}
                        </div>
                    </div>
                </div>
                <div class="d-grid gap-2 mt-3">
                    <button type="button" class="btn btn-pill btn-block btn-success mb-4"
                        id="next-step-1">Siguiente</button>
                </div>
            </div>
            <div id="step-2" class="form-step" style="display: none;">
                <div class="mb-3">
                    <h4 class="fw-light text-muted">Información escolar</h4>
                </div>
                <div class="row g-3">
                    <div class="col-md-6">
                        <div class="mb-3">
                            <label for="{{ form.matricula.id_for_label }}" class="form-label">Matrícula:</label>
                            {{ form.matricula }}
                            <div class="form-text" id="basic-addon4">
                                Este formato sólo admite números.
                            </div>
                        </div>
                    </div>
                    <div class="col-md-6">
                        <div class="mb-3">
                            <label for="{{ form.programa_educativo.id_for_label }}" class="form-label">Programa
                                Educativo:</label>
                            {{ form.programa_educativo }}
                        </div>
                    </div>
                </div>
                <div class="row g-3">
                    <div class="col-md-6">
                        <div class="mb-3">
                            <label for="{{ form.correo_institucional.id_for_label }}" class="form-label">Correo
                                Institucional:</label>
                            {{ form.correo_institucional }}
                            <div class="form-text">
                                Incluye un símbolo "@" en tu dirección de correo electrónico.
                            </div>
                        </div>
                    </div>
                </div>
                <div class="d-grid gap-2 mt-3">
                    <button type="button" class="btn btn-pill btn-block btn-success mb-1"
                        id="next-step-2">Siguiente</button>
                    <button type="button" class="btn btn-pill btn-block btn-secondary mb-2"
                        id="prev-step-2">Anterior</button>
                </div>
            </div>
            <div id="step-3" class="form-step" style="display: none;">
                <div class="mb-3">
                    <h4 class="fw-light text-muted">Resumen</h4>
                </div>
                <div class="row g-3">
                    <div class="col-md-12">
                        <div class="mb-3">
                            <label class="form-label">Usuario:</label>
                            <input class="form-control text-muted" type="text" value="Tu matrícula" readonly>
                        </div>
                    </div>
                </div>
                <div class="row g-3">
                    <div class="col-md-12">
                        <div class="mb-3">
                            <label class="form-label">Contraseña:</label>
                            <input class="form-control text-muted" type="text" value="Tu matrícula" readonly>
                        </div>
                    </div>
                </div>
                {{ user_form.password1 }}
                {{ user_form.password2 }}
                {{ user_form.username }}
                {{ user_form.es_alumno }}
                <div class="d-grid gap-2 mt-3">
                    <input type="submit" value="Registrarse" class="btn btn-pill text-white btn-block btn-success mb-1"
                        id="submit-btn">
                    <button type="button" class="btn btn-pill btn-block btn-secondary mb-2"
                        id="prev-step-2">Anterior</button>
                </div>
            </div>
        </form>
    </div>
</div>

<script src="https://code.jquery.com/jquery-3.6.0.min.js"></script>
<script>
    $(document).ready(function () {
        var currentStep = 1;
        var formSteps = $('.form-step');
        var nextBtns = $('[id^="next-step"]');
        var prevBtns = $('[id^="prev-step"]');
        var submitBtn = $('#submit-btn');

        nextBtns.on('click', function () {
            var currentFormStep = $(this).closest('.form-step');
            var nextFormStep = currentFormStep.next('.form-step');
            var isValid = true;

            currentFormStep.find('input:required, select:required').each(function () {
                if ($(this).val() === '') {
                    isValid = false;
                    $(this).addClass('is-invalid');
                } else {
                    $(this).removeClass('is-invalid');
                }
            });

            if (isValid) {
                currentFormStep.hide();
                nextFormStep.show();
                currentStep++;
            }
        });

        prevBtns.on('click', function () {
            var currentFormStep = $(this).closest('.form-step');
            var prevFormStep = currentFormStep.prev('.form-step');

            currentFormStep.hide();
            prevFormStep.show();
            currentStep--;
        });

        submitBtn.on('click', function () {
            var currentFormStep = $(this).closest('.form-step');
            var isValid = true;

            currentFormStep.find('input:required, select:required').each(function () {
                if ($(this).val() === '') {
                    isValid = false;
                    $(this).addClass('is-invalid');
                } else {
                    $(this).removeClass('is-invalid');
                }
            });

            if (!isValid) {
                return false;
            }
        });
    });
</script>
{% endblock %}